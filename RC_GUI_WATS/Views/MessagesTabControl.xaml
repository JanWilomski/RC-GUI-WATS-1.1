<UserControl x:Class="RC_GUI_WATS.Views.MessagesTabControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:views="clr-namespace:RC_GUI_WATS.Views"
             mc:Ignorable="d">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="2*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="3*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Panel Capital -->
        <Grid Grid.Row="0" Margin="5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Left side - capital information -->
            <Border BorderBrush="DarkGray" BorderThickness="1" Grid.Column="0">
                <Grid Margin="5">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Capital Header -->
                    <TextBlock Grid.Row="0" Grid.ColumnSpan="2" Text="Capital" FontWeight="Bold" Margin="0,0,0,5"/>
                    
                    <!-- Open Capital -->
                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Open Capital:" Margin="0,0,10,0"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding OpenCapitalText}" HorizontalAlignment="Right"/>
                    
                    <!-- Accrued Capital -->
                    <TextBlock Grid.Row="2" Grid.Column="0" Text="Accrued Capital:" Margin="0,0,10,0"/>
                    <TextBlock Grid.Row="2" Grid.Column="1" Text="{Binding AccruedCapitalText}" HorizontalAlignment="Right"/>
                    
                    <!-- Total Capital -->
                    <TextBlock Grid.Row="3" Grid.Column="0" Text="Total Capital:" Margin="0,0,10,0"/>
                    <TextBlock Grid.Row="3" Grid.Column="1" Text="{Binding TotalCapitalText}" HorizontalAlignment="Right"/>
                    
                    <!-- Limits -->
                    <TextBlock Grid.Row="4" Grid.ColumnSpan="2" Text="Limits" FontWeight="Bold" Margin="0,10,0,5"/>
                    
                    <!-- Messages -->
                    <TextBlock Grid.Row="5" Grid.Column="0" Text="Messages:" Margin="0,0,10,0"/>
                    <StackPanel Grid.Row="5" Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock Text="{Binding MessagesPercentageText}" Foreground="{Binding MessagesPercentageBrush}"/>
                        <TextBlock Text=" of "/>
                        <TextBlock Text="{Binding CurrentCapital.MessagesLimit}"/>
                    </StackPanel>
                    
                    <!-- Capital -->
                    <TextBlock Grid.Row="6" Grid.Column="0" Text="Capital:" Margin="0,0,10,0"/>
                    <StackPanel Grid.Row="6" Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                        <TextBlock Text="{Binding CurrentCapital.CapitalPercentage, StringFormat={}{0}%}" 
                                  Foreground="{Binding CapitalPercentageBrush}"/>
                        <TextBlock Text=" of "/>
                        <TextBlock Text="{Binding CurrentCapital.CapitalLimit}"/>
                    </StackPanel>
                </Grid>
            </Border>
            
            <!-- Heartbeat indicator in the top right -->
            <StackPanel Grid.Column="2" VerticalAlignment="Top" Margin="10,0,0,0">
                <TextBlock Text="RC Server Status:" FontSize="11" Margin="0,0,0,2" Foreground="Gray"/>
                <views:HeartbeatIndicatorControl DataContext="{Binding HeartbeatIndicator}"/>
            </StackPanel>
        </Grid>
        
        <!-- Positions DataGrid -->
        <DataGrid Grid.Row="1" AutoGenerateColumns="False" 
                  ItemsSource="{Binding Positions}"
                  CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True" Margin="5">
            <DataGrid.Columns>
                <DataGridTextColumn Header="#" Binding="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type DataGridRow}}, Path=Header}" Width="30"/>
                <DataGridTextColumn Header="ISIN" Binding="{Binding ISIN}" Width="120"/>
                <DataGridTextColumn Header="Ticker" Binding="{Binding Ticker}" Width="80"/>
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="*"/>
                <DataGridTextColumn Header="Net" Binding="{Binding Net}" Width="60"/>
                <DataGridTextColumn Header="OpenLong" Binding="{Binding OpenLong}" Width="80"/>
                <DataGridTextColumn Header="OpenShort" Binding="{Binding OpenShort}" Width="80"/>
            </DataGrid.Columns>
        </DataGrid>
        
        <!-- CCG Messages Header -->
        <Grid Grid.Row="2" Margin="5,10,5,5">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <TextBlock Grid.Column="0" Text="CCG Messages" FontWeight="Bold" FontSize="14" VerticalAlignment="Center"/>
            <Button Grid.Column="1" Content="Rewind" Command="{Binding RewindCommand}"
                    Padding="10,2" Margin="5,0"/>
            <Button Grid.Column="2" Content="Clear" Command="{Binding ClearCcgMessagesCommand}"
                    Padding="10,2" Margin="5,0,0,0"/>
        </Grid>
        
        <!-- CCG Messages DataGrid -->
        <DataGrid Grid.Row="3" AutoGenerateColumns="False" 
                  ItemsSource="{Binding CcgMessages}"
                  CanUserAddRows="False" CanUserDeleteRows="False" IsReadOnly="True" 
                  Margin="5" AlternatingRowBackground="AliceBlue" 
                  GridLinesVisibility="All" FontFamily="Consolas" FontSize="10"
                  LoadingRow="CcgDataGrid_LoadingRow" HeadersVisibility="All">
            <DataGrid.Columns>
                <DataGridTextColumn Header="Type" Binding="{Binding TypeIndicator}" Width="40"/>
                <DataGridTextColumn Header="Header" Binding="{Binding Header}" Width="150"/>
                <DataGridTextColumn Header="Name" Binding="{Binding Name}" Width="120"/>
                <DataGridTextColumn Header="MsgSeqNum" Binding="{Binding MsgSeqNum}" Width="80"/>
                <DataGridTextColumn Header="Date Received" Binding="{Binding DateReceivedString}" Width="130"/>
                <DataGridTextColumn Header="Transact Time" Binding="{Binding TransactTimeString}" Width="90"/>
                <DataGridTextColumn Header="Price" Binding="{Binding PriceString}" Width="100"/>
                <DataGridTextColumn Header="Side" Binding="{Binding Side}" Width="50"/>
                <DataGridTextColumn Header="Symbol(ISIN)" Binding="{Binding Symbol}" Width="120"/>
                <DataGridTextColumn Header="ClientOrderID" Binding="{Binding ClientOrderID}" Width="120"/>
            </DataGrid.Columns>
        </DataGrid>
        
        <!-- Buttons panel -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" HorizontalAlignment="Left" Margin="5">
            <Button Content="Kill switch" Background="Red" Foreground="White" 
                    Command="{Binding AllSwitchCommand}"
                    Padding="10,2" Margin="0,0,5,0"/>
        </StackPanel>
    </Grid>
</UserControl>